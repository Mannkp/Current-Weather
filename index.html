<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK/Weather</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind:wght@300;500&display=swap" rel="stylesheet">
    <!-- <script src="script.js" defer></script> -->
    <!-- <script src="simpleWayScript.js" defer></script> -->
</head>
<body>
    <div class="main">
        <div class="nav">
            <h1>Indian Weather Report</h1>
        </div>
        <div class="search">
            <input type="input" id="inp" name="city" placeholder="Enter City" />
            <button class="btn"><img src="./magnifier.png" alt=""></button>
        </div>
        <div class="container">
            
        </div>
    </div>
    <script>
        let city;
let userCityInput = document.querySelector("#inp");
let searchBtn = document.querySelector(".btn");
const container = document.querySelector(".container");

//This is a new api and may produce in accurate information, so using simple way around using city names.
const fetchCityLocation = async (city) => {
    try{
        // const response = await fetch(`http://api.openweathermap.org/geo/1.0/direct?q=${city}&appid=e5738002c5bea4b0bc71830ac421fe8a`);
        const response = await fetch(`http://api.openweathermap.org/geo/1.0/direct?q=${city},IN&appid=e5738002c5bea4b0bc71830ac421fe8a`);
        const data = await response.json();
        const { lat, lon } = data[0]; //same as: latitude = data[0].lat; longitude = data[0].lon;
        return {latitude: lat, longitude: lon};
    }
    catch (error){
        console.log("Error: " , error);
    }
};

const fetchCurrentWeather = async (latitude , longitude) => {
    try{
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=e5738002c5bea4b0bc71830ac421fe8a`);
        const data = await res.json();
        let desc = data.weather[0].description;
        let icon = data.weather[0].icon;
        let avgTemp = ((data.main.temp) - 273.15).toPrecision(4);
        let feelsLike = ((data.main.feels_like) - 273.15).toPrecision(4);
        let humidity = (data.main.humidity).toPrecision(4);
        let windSpeed = (data.wind.speed).toPrecision(4);
        container.innerHTML = `<h1>${city}</h1>
        <h2>Avg. Temperature: ${avgTemp}°C</h2>
        <img src="https://openweathermap.org/img/wn/${icon}.png" class="myIcon"/>
        <h2>Feels Like: ${feelsLike}°C</h2>
        <h2>${desc}</h2>
        <h2>Wind Speed: ${windSpeed} m/s</h2>
        <h2>Humidity: ${humidity}%</h2>`;
    }
    catch(error){ 
        console.log("Error: " , error);
    }
};

const searchCity = async () => {
    city = await userCityInput.value;
    let {latitude, longitude} = await fetchCityLocation(city);
    fetchCurrentWeather(latitude,longitude);
};


searchBtn.addEventListener("click" , async () => {
    searchCity();
});

userCityInput.addEventListener("keydown" , async (e) => {
    if (e.key == "Enter") {  //checks whether the pressed key is "Enter"
        searchCity();
    }
});

if(city === undefined){
    city="vadodara";
    fetchCurrentWeather(22.2973142,73.1942567);
}
    </script>
</body>
</html>
